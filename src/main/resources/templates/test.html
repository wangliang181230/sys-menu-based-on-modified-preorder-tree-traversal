<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<title>测试左右值树型菜单</title>

	<script src="jquery-1.8.0.min.js" type="application/javascript"></script>
	<style>
		th, td {
			padding: 3px 10px;
			text-align: left;
			border: solid 1px black;
		}

		.name-head {
			text-align: left;
		}
	</style>
</head>
<body>
	<form id="insertPanel">
		新增：
		<label for="name">节点名称：</label><input id="name" name="name" type="text"/>
		<label for="pid">父节点ID：</label><input id="pid" name="pid" type="text"/>
		<input value="提交" type="button" onclick="insert()"/>
	</form>
	<form id="movePanel">
		移动：
		<label for="id">节点ID：</label><input id="id" name="id" type="text"/>
		<label for="targetPid">移动到的节点ID：</label><input id="targetPid" name="targetPid" type="text"/>
		<input value="提交" type="button" onclick="move()"/>
	</form>

	<div><input value="刷新" type="button" onclick="loadTree()"/></div>
	<div id="treePanel" style="margin-top: 5px">
		<table border='1' cellspacing='1' style='border-collapse:collapse'>
			<thead>
			<tr>
				<th>ID</th>
				<th>父ID</th>
				<th>根ID</th>
				<th style='text-align: right'>左值</th>
				<th class='name-head'>节点名称</th>
				<th>右值</th>
				<th>子节点数</th>
				<th>层级</th>
				<th>类型</th>
				<th>操作</th>
			</tr>
			</thead>
			<tbody id="treeTableBody">
			</tbody>
		</table>
	</div>

	<script>
		function loadTree() {
			$.ajax({
				url: "./api/v1/sys-menu/tree",
				success: function (tree) {
					let html = "";
					html += buildTreeHtml(tree, "");
					$("#treeTableBody").html(html).hide().fadeIn(400);
				}
			});
		}

		function buildTreeHtml(tree, s) {
			if (!tree || tree.length === 0) {
				return "";
			}

			let html = "";
			for (let i = 0; i < tree.length; i++) {
				let menu = tree[i];
				html += "<tr>" +
						"<td>" + menu.id + "</td>" +
						"<td>" + menu.pid + "</td>" +
						"<td>" + menu.rootId + "</td>" +
						"<td style='text-align: right'>" + menu.l + "</td>" +
						"<td>" + s + menu.name + "</td>" +
						"<td>" + menu.r + "</td>" +
						"<td>" + menu.childSize + "</td>" +
						"<td>" + menu.level + "</td>" +
						"<td>" + (menu.root ? "根节点" : "") + (menu.leaf ? (menu.root ? "、" : "") + "叶节点" : "") + "</td>" +
						"<td>" +
						"	<a href=\"javascript:del('" + menu.id + "')\">删除</a>" +
						"</td>" +
						"</tr>";
				html += buildTreeHtml(menu.childList, s + "—&nbsp;");
			}
			return html;
		}

		function insert() {
			let name = $("#name").val();
			let pid = $("#pid").val();

			if (!name) {
				alert("节点名称必填");
				$("#name").focus();
				return;
			}

			$.ajax({
				url: "./api/v1/sys-menu/insert",
				type: "post",
				data: JSON.stringify({
					"name": name,
					"pid": pid || ""
				}),
				contentType: "application/json",
				success: function (data) {
					alert("新增成功");
					loadTree();
				},
				error: function (XMLHttpRequest, textStatus, errorThrown) {
					alert("新增失败：[" + textStatus + "]" + XMLHttpRequest.responseText);
				}
			});
		}

		function move() {
			let id = $("#id").val();
			let targetPid = $("#targetPid").val();

			if (!id) {
				alert("节点ID必填");
				$("#id").focus();
				return;
			}

			$.ajax({
				url: "./api/v1/sys-menu/move",
				type: "post",
				data: JSON.stringify({
					"id": id,
					"targetPid": targetPid || ""
				}),
				contentType: "application/json",
				success: function (data) {
					alert("移动成功");
					loadTree();
				},
				error: function (XMLHttpRequest, textStatus, errorThrown) {
					alert("移动失败：[" + textStatus + "]" + XMLHttpRequest.responseText);
				}
			});
		}

		function del(id) {
			$.ajax({
				url: "./api/v1/sys-menu/delete?id=" + id,
				type: "post",
				success: function (data) {
					alert("删除成功");
					loadTree();
				},
				error: function (XMLHttpRequest, textStatus, errorThrown) {
					alert("删除失败：[" + textStatus + "]" + XMLHttpRequest.responseText);
				}
			});
		}

		loadTree();
	</script>
</body>
</html>